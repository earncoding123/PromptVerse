
{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the RealPrompt application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "displayName": {
          "type": "string",
          "description": "User's display name."
        },
        "photoURL": {
          "type": "string",
          "description": "URL of the user's profile photo.",
          "format": "uri"
        },
        "creationTime": {
          "type": "string",
          "description": "Timestamp of when the user account was created.",
          "format": "date-time"
        },
        "lastSignInTime": {
          "type": "string",
          "description": "Timestamp of the user's last sign-in.",
          "format": "date-time"
        },
        "isAdmin": {
          "type": "boolean",
          "description": "Indicates whether the user is an administrator."
        }
      },
      "required": [
        "id",
        "email",
        "displayName",
        "creationTime"
      ]
    },
    "Prompt": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Prompt",
      "type": "object",
      "description": "Represents a prompt available on the marketplace.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the prompt."
        },
        "title": {
          "type": "string",
          "description": "Title of the prompt."
        },
        "slug": {
          "type": "string",
          "description": "Slug for the prompt, used in URLs."
        },
        "description": {
          "type": "string",
          "description": "Short description of the prompt."
        },
        "tags": {
          "type": "array",
          "description": "Tags associated with the prompt.",
          "items": {
            "type": "string"
          }
        },
        "category": {
          "type": "string",
          "description": "Category of the prompt."
        },
        "content": {
          "type": "string",
          "description": "Full content of the prompt."
        },
        "price": {
          "type": "number",
          "description": "Price of the prompt.",
          "format": "number"
        },
        "coverImage": {
          "type": "string",
          "description": "URL of the prompt's cover image.",
          "format": "uri"
        },
        "samples": {
          "type": "array",
          "description": "URLs of sample images generated by the prompt.",
          "items": {
            "type": "string"
          }
        },
        "seo": {
          "type": "string",
          "description": "JSON string of seo parameters"
        },
        "visible": {
          "type": "boolean",
          "description": "Indicates whether the prompt is visible on the marketplace."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp of when the prompt was created.",
          "format": "date-time"
        },
        "createdBy": {
          "type": "string",
          "description": "Reference to User who created the prompt. (Relationship: User 1:N Prompt)"
        }
      },
      "required": [
        "id",
        "title",
        "slug",
        "description",
        "category",
        "content",
        "price",
        "coverImage",
        "visible",
        "createdAt",
        "createdBy"
      ]
    },
    "Purchase": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Purchase",
      "type": "object",
      "description": "Represents a user's purchase of a prompt.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the purchase."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User who made the purchase. (Relationship: User 1:N Purchase)"
        },
        "promptId": {
          "type": "string",
          "description": "Reference to Prompt that was purchased. (Relationship: Prompt 1:N Purchase)"
        },
        "purchaseDate": {
          "type": "string",
          "description": "Timestamp of when the prompt was purchased.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "promptId",
        "purchaseDate"
      ]
    },
    "Download": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Download",
      "type": "object",
      "description": "Represents a user's download of a prompt.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the download."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User who downloaded the prompt. (Relationship: User 1:N Download)"
        },
        "promptId": {
          "type": "string",
          "description": "Reference to Prompt that was downloaded. (Relationship: Prompt 1:N Download)"
        },
        "downloadDate": {
          "type": "string",
          "description": "Timestamp of when the prompt was downloaded.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "promptId",
        "downloadDate"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information. Path-based ownership ensures only the user or an admin can access the profile.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/prompts/{promptId}",
        "definition": {
          "entityName": "Prompt",
          "schema": {
            "$ref": "#/backend/entities/Prompt"
          },
          "description": "Stores prompt details. Includes denormalized 'createdBy' (userId) for authorization independence.",
          "params": [
            {
              "name": "promptId",
              "description": "The unique identifier for the prompt."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/purchases/{purchaseId}",
        "definition": {
          "entityName": "Purchase",
          "schema": {
            "$ref": "#/backend/entities/Purchase"
          },
          "description": "Stores purchase records for each user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "purchaseId",
              "description": "The unique identifier for the purchase."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/downloads/{downloadId}",
        "definition": {
          "entityName": "Download",
          "schema": {
            "$ref": "#/backend/entities/Download"
          },
          "description": "Stores download records for each user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "downloadId",
              "description": "The unique identifier for the download."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Marks a user as an administrator. Existence of document grants admin privileges.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure prioritizes authorization independence and clarity, crucial for security and scalability in RealPrompt. User data is stored under `/users/{userId}`, providing secure, path-based ownership. Prompts are stored in a top-level `/prompts` collection, which simplifies listing and querying. Purchases and downloads are stored as subcollections under `/users/{userId}`. Admin status is managed through the presence of a document in the `/roles_admin/{userId}` collection.\n\n**Authorization Independence:**\n*   Prompt documents in `/prompts` include a `createdBy` field, which is the user ID of the prompt creator. This denormalization allows security rules to verify ownership without needing to perform a `get()` operation on the user document.\n*   Purchase and Download records are stored within user subcollections, ensuring that access can be controlled based on the user's ID without requiring additional database reads.\n\n**QAPs (Rules are not Filters):**\n*   The separation of prompts into a single `/prompts` collection simplifies listing prompts with security rules. Visibility is controlled via the `visible` field on the Prompt document, and admin status is checked by the existance of the admin role document. The rules only need to evaluate the `visible` field and the requesting user's role, avoiding complex filtering logic within the rules themselves.\n*   User-specific data (purchases, downloads) is stored under the respective user's document, ensuring that listing these subcollections only returns data accessible to that user."
  }
}
